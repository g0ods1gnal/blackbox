# Gruvbox Hard Dark Sway Configuration
# Generated by Ansible for {{ ansible_user }}@{{ hostname }}

### Variables
set $mod Mod1
set $term foot
set $menu fuzzel

# Gruvbox Hard Dark color scheme
set $bg_hard    {{ cyber_colors.bg_hard }}
set $bg         {{ cyber_colors.bg1 }}
set $bg_soft    {{ cyber_colors.bg_soft }}
set $fg         {{ cyber_colors.fg }}
set $fg_dim     {{ cyber_colors.fg4 }}
set $red        {{ cyber_colors.red }}
set $green      {{ cyber_colors.green }}
set $yellow     {{ cyber_colors.yellow }}
set $blue       {{ cyber_colors.blue }}
set $purple     {{ cyber_colors.purple }}
set $aqua       {{ cyber_colors.aqua }}
set $orange     {{ cyber_colors.orange }}
set $gray       {{ cyber_colors.gray }}

### Output configuration (monitors)
# Solid Gruvbox background
output * bg ~/Pictures/*.png fill

# Include monitor-specific configuration
include ~/.config/sway/config.d/monitors

### Input configuration
# Keyboard settings
input type:keyboard {
    xkb_layout pt
    xkb_options caps:escape
    repeat_delay 300
    repeat_rate 50
}

# Touchpad settings
input type:touchpad {
    dwt enabled
    tap enabled
    natural_scroll enabled
    middle_emulation enabled
    scroll_factor 0.5
}

### Idle management
exec swayidle -w \
    timeout 300 'swaylock -f -c 1d2021' \
    timeout 600 'swaymsg "output * dpms off"' \
    resume 'swaymsg "output * dpms on"' \
    before-sleep 'swaylock -f -c 1d2021'

### Key bindings

# Launch applications
bindsym $mod+Return exec $term
bindsym $mod+d exec $menu
bindsym $mod+Shift+q kill
bindsym $mod+Shift+c reload
bindsym $mod+Shift+e exec swaynag -t warning -m 'Exit Sway?' \
    -B 'Yes' 'swaymsg exit' \
    --background=$bg_hard \
    --text=$fg \
    --button-background=$aqua \
    --button-text=$bg_hard \
    --border=$aqua \
    --border-bottom=$aqua

# Movement (vim-style hjkl)
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

# Move windows
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right

# Alternative arrow keys
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# Workspaces (1-5 for minimal setup)
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"

# Switch to workspace
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5

# Move container to workspace
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5

# Layout management
bindsym $mod+b splith
bindsym $mod+v splitv
bindsym $mod+f fullscreen
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# Floating windows
bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle

# Move focus to parent/child container
bindsym $mod+a focus parent
bindsym $mod+z focus child

# Scratchpad (hidden window storage)
bindsym $mod+Shift+minus move scratchpad
bindsym $mod+minus scratchpad show

# Resize mode
mode "resize" {
    # Vim keys
    bindsym h resize shrink width 10px
    bindsym j resize grow height 10px
    bindsym k resize shrink height 10px
    bindsym l resize grow width 10px
    
    # Arrow keys
    bindsym Left resize shrink width 10px
    bindsym Down resize grow height 10px
    bindsym Up resize shrink height 10px
    bindsym Right resize grow width 10px
    
    # Return to default mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

# Screenshots
bindsym Print exec grim -g "$(slurp)" {{ user_home }}/Pictures/$(date +%Y%m%d-%H%M%S).png && \
    notify-send "Screenshot" "Selection saved to Pictures"
bindsym Shift+Print exec grim {{ user_home }}/Pictures/$(date +%Y%m%d-%H%M%S).png && \
    notify-send "Screenshot" "Full screen saved to Pictures"
bindsym $mod+Print exec grim -g "$(slurp)" - | wl-copy && \
    notify-send "Screenshot" "Selection copied to clipboard"

# Lock screen
bindsym $mod+Escape exec swaylock -f -c 1d2021

# Monitor management
bindsym $mod+p exec ~/.local/bin/monitor-manager

# Media keys (laptop function keys)
bindsym XF86AudioRaiseVolume exec pamixer -i 5 && \
    notify-send -t 1000 "Volume" "$(pamixer --get-volume)%"
bindsym XF86AudioLowerVolume exec pamixer -d 5 && \
    notify-send -t 1000 "Volume" "$(pamixer --get-volume)%"
bindsym XF86AudioMute exec pamixer -t && \
    notify-send -t 1000 "Volume" "$(pamixer --get-mute && echo 'Muted' || echo 'Unmuted')"
bindsym XF86MonBrightnessUp exec brightnessctl set +5% && \
    notify-send -t 1000 "Brightness" "$(brightnessctl get)"
bindsym XF86MonBrightnessDown exec brightnessctl set 5%- && \
    notify-send -t 1000 "Brightness" "$(brightnessctl get)"

# Additional media controls
bindsym XF86AudioPlay exec playerctl play-pause
bindsym XF86AudioNext exec playerctl next
bindsym XF86AudioPrev exec playerctl previous

### Window styling (Gruvbox Hard)
default_border pixel 2
default_floating_border pixel 2

# Gaps
gaps inner 6
gaps outer 3

# Smart gaps (no gaps when only one window)
smart_gaps on

# Smart borders (no borders when only one window)
smart_borders on

# Window colors (border, background, text, indicator, child_border)
client.focused          $aqua      $bg_hard   $fg        $green     $aqua
client.focused_inactive $gray      $bg_hard   $fg        $gray      $gray
client.unfocused        $bg        $bg_hard   $fg_dim    $bg        $bg
client.urgent           $red       $red       $bg_hard   $red       $red
client.placeholder      $bg        $bg_hard   $fg_dim    $bg        $bg
client.background       $bg_hard

### Window rules

# Floating windows
for_window [app_id="pavucontrol"] floating enable
for_window [app_id="blueman-manager"] floating enable
for_window [app_id="nm-connection-editor"] floating enable
for_window [title="^Open File$"] floating enable
for_window [title="^Save File$"] floating enable
for_window [app_id="firefox" title="^Picture-in-Picture$"] floating enable, sticky enable

# Inhibit idle for fullscreen windows
for_window [class=".*"] inhibit_idle fullscreen
for_window [app_id=".*"] inhibit_idle fullscreen

### Status bar
bar {
    swaybar_command waybar
}

### Auto-start applications
exec mako
exec nm-applet --indicator
exec blueman-applet

# NVIDIA-specific settings (if applicable)
{% if nvidia_check is defined and nvidia_check.rc == 0 %}
# Force NVIDIA to use Wayland
exec export GBM_BACKEND=nvidia-drm
exec export __GLX_VENDOR_LIBRARY_NAME=nvidia
exec export WLR_NO_HARDWARE_CURSORS=1
{% endif %}

### Additional keybindings for power management
set $mode_system System: (l) lock, (e) logout, (s) suspend, (r) reboot, (p) poweroff
mode "$mode_system" {
    bindsym l exec swaylock -f -c 1d2021, mode "default"
    bindsym e exec swaymsg exit, mode "default"
    bindsym s exec systemctl suspend, mode "default"
    bindsym r exec systemctl reboot, mode "default"
    bindsym p exec systemctl poweroff, mode "default"
    
    # Return to default mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+Shift+Escape mode "$mode_system"

### Workspace assignments (optional)
# Example: assign [app_id="firefox"] workspace $ws1
# Example: assign [class="Burp"] workspace $ws3

### Startup notification
exec notify-send -t 3000 "Sway" "Window manager started" -i dialog-information
